
var isCritical =
 {
  "AZ101": {
    "ERC": 69,
    "obsdate": "09\/27\/2016",
    "ERC24": 67,
    "ERC48": 65,
    "ERC72": 64,
    "ThreeDayAverage": 67,
    "ERC_threshold": 85,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-04 08:50:44",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "3000",
    "center_id": "AZ-DUCK",
    "CWA": "VEF",
    "justification": "",
    "remarks": "",
    "diff": -18,
    "status": "notcritical"
  },
  "AZ102": {
    "ERC": 59.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 58.5,
    "ERC48": 56,
    "ERC72": 54.5,
    "ThreeDayAverage": 58,
    "ERC_threshold": 85,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-04 08:50:44",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7200",
    "center_id": "AZ-DUCK",
    "CWA": "VEF",
    "justification": "",
    "remarks": "",
    "diff": -27,
    "status": "notcritical"
  },
  "AZ104": {
    "ERC": 44,
    "obsdate": "09\/27\/2016",
    "ERC24": 41,
    "ERC48": 39,
    "ERC72": 36,
    "ThreeDayAverage": 41.3,
    "ERC_threshold": 85,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-04 08:50:44",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "6500",
    "center_id": "AZ-DUCK",
    "CWA": "FGZ",
    "justification": "",
    "remarks": "",
    "diff": -43.666666666667,
    "status": "notcritical"
  },
  "ID422": {
    "ERC": 44,
    "obsdate": "09\/27\/2016",
    "ERC24": 40.7,
    "ERC48": 38.7,
    "ERC72": 43,
    "ThreeDayAverage": 41.1,
    "ERC_threshold": 66,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 11:28:21",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "SCC-SIM",
    "CWA": "PIH",
    "justification": "",
    "remarks": "",
    "diff": -24.888888888889,
    "status": "notcritical"
  },
  "ID400": {
    "ERC": 69,
    "obsdate": "09\/27\/2016",
    "ERC24": 68,
    "ERC48": 65,
    "ERC72": 61,
    "ThreeDayAverage": 67.3,
    "ERC_threshold": 40,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-19 16:04:42",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7000",
    "center_id": "BDC-WIL",
    "CWA": "BOI",
    "justification": "",
    "remarks": "Live Fuels are still in critical stage with extreme fire behavior still very possible until season ending event or green up.",
    "diff": 27.333333333333,
    "status": "critical"
  },
  "ID420": {
    "ERC": 57,
    "obsdate": "09\/27\/2016",
    "ERC24": 56,
    "ERC48": 55,
    "ERC72": 53,
    "ThreeDayAverage": 56,
    "ERC_threshold": 40,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-19 16:04:42",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7000",
    "center_id": "BDC-WIL",
    "CWA": "BOI",
    "justification": "",
    "remarks": "Live Fuels are still in critical stage with extreme fire behavior still very possible until season ending event or green up.",
    "diff": 16,
    "status": "critical"
  },
  "ID423": {
    "ERC": 49,
    "obsdate": "09\/27\/2016",
    "ERC24": 48,
    "ERC48": 46,
    "ERC72": 42,
    "ThreeDayAverage": 47.7,
    "ERC_threshold": 40,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-19 16:04:42",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7000",
    "center_id": "BDC-WIL",
    "CWA": "BOI",
    "justification": "",
    "remarks": "Live Fuels are still in critical stage with extreme fire behavior still very possible until season ending event or green up.",
    "diff": 7.6666666666667,
    "status": "critical"
  },
  "NV450": {
    "ERC": 91,
    "obsdate": "09\/27\/2016",
    "ERC24": 90,
    "ERC48": 89,
    "ERC72": 86,
    "ThreeDayAverage": 90,
    "ERC_threshold": 80,
    "manual": "critical",
    "updated": "2016-06-08 15:41:27",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "CCD",
    "CWA": "RNO",
    "justification": "Northern portion of zone is cured with low RH and high Winds forecast.",
    "remarks": "",
    "diff": 10,
    "status": "critical"
  },
  "NV453": {
    "ERC": 84,
    "obsdate": "09\/27\/2016",
    "ERC24": 81.7,
    "ERC48": 81.3,
    "ERC72": 77,
    "ThreeDayAverage": 82.3,
    "ERC_threshold": 85,
    "manual": "----Select Manual Override------",
    "updated": "2016-06-08 15:41:27",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "CCD",
    "CWA": "RNO",
    "justification": "",
    "remarks": "",
    "diff": -2.6666666666667,
    "status": "borderline"
  },
  "NV459": {
    "ERC": 89,
    "obsdate": "09\/27\/2016",
    "ERC24": 87,
    "ERC48": 86,
    "ERC72": 82,
    "ThreeDayAverage": 87.3,
    "ERC_threshold": 85,
    "manual": "----Select Manual Override------",
    "updated": "2016-06-08 15:41:27",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "CCD",
    "CWA": "RNO",
    "justification": "",
    "remarks": "",
    "diff": 2.3333333333333,
    "status": "critical"
  },
  "UT495": {
    "ERC": 68,
    "obsdate": "09\/27\/2016",
    "ERC24": 66,
    "ERC48": 65.5,
    "ERC72": 66.5,
    "ThreeDayAverage": 66.5,
    "ERC_threshold": 85,
    "manual": "critical",
    "updated": "2016-07-07 16:20:43",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "CDC-BUR",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": -18.5,
    "status": "notcritical"
  },
  "UT498": {
    "ERC": 51,
    "obsdate": "09\/27\/2016",
    "ERC24": 50,
    "ERC48": 47.5,
    "ERC72": 44,
    "ThreeDayAverage": 49.5,
    "ERC_threshold": 85,
    "manual": "----Select Manual Override------",
    "updated": "2016-06-20 12:20:52",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "5460",
    "center_id": "CDC-EAST",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": -35.5,
    "status": "notcritical"
  },
  "UT496": {
    "ERC": 35.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 34,
    "ERC48": 32,
    "ERC72": 28.8,
    "ThreeDayAverage": 33.8,
    "ERC_threshold": 88,
    "manual": "----Select Manual Override------",
    "updated": "2016-07-08 11:23:07",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "CDC-SID",
    "CWA": "SLC",
    "justification": "",
    "remarks": "Brush at lower elevations is starting to become available to burn. Timber litter and dead and down is the primary carrier of fire at this point. Conditions will become critical as the ERC approaches the 90th percentile.",
    "diff": -54.166666666667,
    "status": "notcritical"
  },
  "UT497": {
    "ERC": 79,
    "obsdate": "09\/27\/2016",
    "ERC24": 77.5,
    "ERC48": 76.5,
    "ERC72": 74.5,
    "ThreeDayAverage": 77.7,
    "ERC_threshold": 70,
    "manual": "----Select Manual Override------",
    "updated": "2016-06-20 11:56:54",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "CDC-SIDLES",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": 7.6666666666667,
    "status": "critical"
  },
  "ID475": {
    "ERC": 42.4,
    "obsdate": "09\/27\/2016",
    "ERC24": 0,
    "ERC48": 38.8,
    "ERC72": 40.4,
    "ThreeDayAverage": 27.1,
    "ERC_threshold": 55,
    "manual": "----Select Manual Override------",
    "updated": "2016-07-18 15:10:58",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "CIC-KNA",
    "CWA": "PIH",
    "justification": "",
    "remarks": "",
    "diff": -27.933333333333,
    "status": "notcritical"
  },
  "ID476": {
    "ERC": 51.75,
    "obsdate": "09\/27\/2016",
    "ERC24": 0,
    "ERC48": 48.5,
    "ERC72": 51,
    "ThreeDayAverage": 33.4,
    "ERC_threshold": 60,
    "manual": "----Select Manual Override------",
    "updated": "2016-07-18 15:10:58",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "CIC-KNA",
    "CWA": "PIH",
    "justification": "",
    "remarks": "",
    "diff": -26.583333333333,
    "status": "notcritical"
  },
  "ID410": {
    "ERC": 37,
    "obsdate": "09\/27\/2016",
    "ERC24": 35,
    "ERC48": 33,
    "ERC72": 35,
    "ThreeDayAverage": 35,
    "ERC_threshold": 80,
    "manual": "critical",
    "updated": "2016-07-25 13:09:59",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "EIC-OLS",
    "CWA": "PIH",
    "justification": "",
    "remarks": "",
    "diff": -45,
    "status": "notcritical"
  },
  "ID411": {
    "ERC": 30,
    "obsdate": "09\/27\/2016",
    "ERC24": 26,
    "ERC48": 23,
    "ERC72": 9,
    "ThreeDayAverage": 26.3,
    "ERC_threshold": 75,
    "manual": "critical",
    "updated": "2016-07-25 13:09:59",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "EIC-OLS",
    "CWA": "PIH",
    "justification": "",
    "remarks": "",
    "diff": -48.666666666667,
    "status": "notcritical"
  },
  "ID413": {
    "ERC": 37,
    "obsdate": "09\/27\/2016",
    "ERC24": 35,
    "ERC48": 33,
    "ERC72": 35,
    "ThreeDayAverage": 35,
    "ERC_threshold": 80,
    "manual": "critical",
    "updated": "2016-07-25 13:09:59",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "EIC-OLS",
    "CWA": "PIH",
    "justification": "",
    "remarks": "",
    "diff": -45,
    "status": "notcritical"
  },
  "NV462": {
    "ERC": "nodata",
    "obsdate": "09\/27\/2016",
    "ERC24": 89.5,
    "ERC48": 89.5,
    "ERC72": 89.5,
    "ThreeDayAverage": 59.7,
    "ERC_threshold": 90,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 15:26:47",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "All",
    "center_id": "LAS",
    "CWA": "VEF",
    "justification": "",
    "remarks": "",
    "diff": -30.333333333333,
    "status": "notcritical"
  },
  "NV463": {
    "ERC": "nodata",
    "obsdate": "09\/27\/2016",
    "ERC24": 88,
    "ERC48": 87,
    "ERC72": 87,
    "ThreeDayAverage": 58.3,
    "ERC_threshold": 77,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 15:26:47",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "All",
    "center_id": "LAS",
    "CWA": "VEF",
    "justification": "",
    "remarks": "",
    "diff": -18.666666666667,
    "status": "notcritical"
  },
  "NV464": {
    "ERC": "nodata",
    "obsdate": "09\/27\/2016",
    "ERC24": 88,
    "ERC48": 87,
    "ERC72": 87,
    "ThreeDayAverage": 58.3,
    "ERC_threshold": 77,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 15:26:47",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "All",
    "center_id": "LAS",
    "CWA": "VEF",
    "justification": "",
    "remarks": "",
    "diff": -18.666666666667,
    "status": "notcritical"
  },
  "NV465": {
    "ERC": "nodata",
    "obsdate": "09\/27\/2016",
    "ERC24": 89.5,
    "ERC48": 89.5,
    "ERC72": 89.5,
    "ThreeDayAverage": 59.7,
    "ERC_threshold": 90,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 15:26:47",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "All",
    "center_id": "LAS",
    "CWA": "VEF",
    "justification": "",
    "remarks": "",
    "diff": -30.333333333333,
    "status": "notcritical"
  },
  "NV466": {
    "ERC": "nodata",
    "obsdate": "09\/27\/2016",
    "ERC24": 91,
    "ERC48": 92,
    "ERC72": 92,
    "ThreeDayAverage": 61,
    "ERC_threshold": 90,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 15:26:47",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "All",
    "center_id": "LAS",
    "CWA": "VEF",
    "justification": "",
    "remarks": "",
    "diff": -29,
    "status": "notcritical"
  },
  "UT488": {
    "ERC": 43,
    "obsdate": "09\/27\/2016",
    "ERC24": 41,
    "ERC48": 38,
    "ERC72": 43,
    "ThreeDayAverage": 40.7,
    "ERC_threshold": 80,
    "manual": "critical",
    "updated": "2016-08-31 11:30:32",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "Below 8000",
    "center_id": "MFC-JOH",
    "CWA": "SLC",
    "justification": "ERC nearing critical threshold with expected lightning in the forecast",
    "remarks": "",
    "diff": -39.333333333333,
    "status": "notcritical"
  },
 
  "UT490": {
    "ERC": 58,
    "obsdate": "09\/27\/2016",
    "ERC24": 55,
    "ERC48": 51,
    "ERC72": 48,
    "ThreeDayAverage": 54.7,
    "ERC_threshold": 87,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-31 11:30:32",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "Below 8000 feet",
    "center_id": "MFC-JOH",
    "CWA": "GJT",
    "justification": "",
    "remarks": "",
    "diff": -32.333333333333,
    "status": "notcritical"
  },
  "UT491": {
    "ERC": 58,
    "obsdate": "09\/27\/2016",
    "ERC24": 56.5,
    "ERC48": 54,
    "ERC72": 52.5,
    "ThreeDayAverage": 56.2,
    "ERC_threshold": 71,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-31 11:30:32",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "Below 8000",
    "center_id": "MFC-JOH",
    "CWA": "GJT",
    "justification": "",
    "remarks": "",
    "diff": -14.833333333333,
    "status": "notcritical"
  },
  "UT479": {
    "ERC": 34.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 32,
    "ERC48": 28.5,
    "ERC72": 18,
    "ThreeDayAverage": 31.7,
    "ERC_threshold": 70,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-14 13:20:30",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "NUC-THO",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": -38.333333333333,
    "status": "notcritical"
  },
  "UT480": {
    "ERC": 31.666666666667,
    "obsdate": "09\/27\/2016",
    "ERC24": 30.7,
    "ERC48": 29.3,
    "ERC72": 15.3,
    "ThreeDayAverage": 30.6,
    "ERC_threshold": 65,
    "manual": "critical",
    "updated": "2016-08-14 13:20:30",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "NUC-THO",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": -34.444444444444,
    "status": "notcritical"
  },
  "UT478": {
    "ERC": 43.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 42.8,
    "ERC48": 41,
    "ERC72": 31.5,
    "ThreeDayAverage": 42.4,
    "ERC_threshold": 87,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-08 13:47:35",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "NUC-WEST",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": -44.583333333333,
    "status": "notcritical"
  },
  "UT492": {
    "ERC": 58,
    "obsdate": "09\/27\/2016",
    "ERC24": 56.3,
    "ERC48": 54.8,
    "ERC72": 56.5,
    "ThreeDayAverage": 56.3,
    "ERC_threshold": 87,
    "manual": "critical",
    "updated": "2016-08-08 13:47:35",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "NUC-WEST",
    "CWA": "SLC",
    "justification": "Received isolated moisture over last few days. FWZ is still in critical overall.",
    "remarks": "",
    "diff": -30.666666666667,
    "status": "notcritical"
  },
  "ID401": {
    "ERC": 65,
    "obsdate": "09\/27\/2016",
    "ERC24": 64,
    "ERC48": 64,
    "ERC72": 69,
    "ThreeDayAverage": 64.3,
    "ERC_threshold": 74,
    "manual": "critical",
    "updated": "2016-08-16 10:26:41",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7000",
    "center_id": "PAC-BUE",
    "CWA": "BOI",
    "justification": "",
    "remarks": "",
    "diff": -9.6666666666667,
    "status": "borderline"
  },
  "ID402": {
    "ERC": 36,
    "obsdate": "09\/27\/2016",
    "ERC24": 33,
    "ERC48": 33,
    "ERC72": 32,
    "ThreeDayAverage": 34,
    "ERC_threshold": 56,
    "manual": "critical",
    "updated": "2016-08-16 10:26:41",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "5000",
    "center_id": "PAC-BUE",
    "CWA": "BOI",
    "justification": "",
    "remarks": "",
    "diff": -22,
    "status": "notcritical"
  },
  "UT493": {
    "ERC": 50,
    "obsdate": "09\/27\/2016",
    "ERC24": 46,
    "ERC48": 41.5,
    "ERC72": 46,
    "ThreeDayAverage": 45.8,
    "ERC_threshold": 88,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-03 16:03:56",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "RFC-EAST",
    "CWA": "SLC",
    "justification": "",
    "remarks": "Indices have been at the 80th and 90th for over a week in the fire weather zone. The continued hot and dry weather pattern is reflected in dead\/down (below 10%) and LFM (near 90%). As a result of the conditions of the fuels, high fire behavior should be expected at all elevations throughout the zone. Storms that have moved through the zone have been localized and not widespread. The Pahvant front recently experienced a large fire. The fire was actively spread at all elevations and fuel types.",
    "diff": -42.166666666667,
    "status": "notcritical"
  },
  "Ut494": {
    "ERC": 45,
    "obsdate": "09\/27\/2016",
    "ERC24": 43,
    "ERC48": 43,
    "ERC72": 55,
    "ThreeDayAverage": 43.7,
    "ERC_threshold": 88,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-03 16:03:56",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "RFC-EAST",
    "CWA": "SLC",
    "justification": "",
    "remarks": "Indices have been at the 80th and 90th for over a week in the fire weather zone. The continued hot and dry weather pattern is reflected in dead\/down (below 10%) and LFM (near 90%). As a result of the conditions of the fuels, high fire behavior should be expected at all elevations throughout the zone. Storms that have moved through the zone have been localized and not widespread. ",
    "diff": -44.333333333333,
    "status": "notcritical"
  },
  "ID424": {
    "ERC": 59.333333333333,
    "obsdate": "09\/27\/2016",
    "ERC24": 57.3,
    "ERC48": 56.7,
    "ERC72": 55.7,
    "ThreeDayAverage": 57.8,
    "ERC_threshold": 80,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 11:28:21",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "SCC-SIM",
    "CWA": "BOI",
    "justification": "",
    "remarks": "",
    "diff": -22.222222222222,
    "status": "notcritical"
  },
  "ID425": {
    "ERC": 39.333333333333,
    "obsdate": "09\/27\/2016",
    "ERC24": 36.3,
    "ERC48": 33.7,
    "ERC72": 29.3,
    "ThreeDayAverage": 36.4,
    "ERC_threshold": 78,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 11:28:21",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "SCC-SIM",
    "CWA": "PIH",
    "justification": "",
    "remarks": "",
    "diff": -41.555555555556,
    "status": "notcritical"
  },
  "ID426": {
    "ERC": 60.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 58,
    "ERC48": 57.5,
    "ERC72": 57,
    "ThreeDayAverage": 58.7,
    "ERC_threshold": 85,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-07 11:28:21",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "SCC-SIM",
    "CWA": "BOI",
    "justification": "",
    "remarks": "",
    "diff": -26.333333333333,
    "status": "notcritical"
  },
  "ID427": {
    "ERC": 39.25,
    "obsdate": "09\/27\/2016",
    "ERC24": 38.8,
    "ERC48": 36.3,
    "ERC72": 17.5,
    "ThreeDayAverage": 38.1,
    "ERC_threshold": 75,
    "manual": "critical",
    "updated": "2016-09-07 11:28:21",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "6000",
    "center_id": "SCC-SIM",
    "CWA": "PIH",
    "justification": "",
    "remarks": "",
    "diff": -36.916666666667,
    "status": "notcritical"
  },
  "WY414": {
    "ERC": 36.25,
    "obsdate": "09\/27\/2016",
    "ERC24": 34,
    "ERC48": 32.3,
    "ERC72": 23.8,
    "ThreeDayAverage": 34.2,
    "ERC_threshold": 44,
    "manual": "notcritical",
    "updated": "2016-09-16 16:29:07",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "TDC-NOR",
    "CWA": "RIW",
    "justification": "",
    "remarks": "",
    "diff": -9.8333333333333,
    "status": "borderline"
  },
  "WY415": {
    "ERC": 26.333333333333,
    "obsdate": "09\/27\/2016",
    "ERC24": 24.3,
    "ERC48": 23.3,
    "ERC72": 21.7,
    "ThreeDayAverage": 24.7,
    "ERC_threshold": 44,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-16 16:29:07",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "TDC-NOR",
    "CWA": "RIW",
    "justification": "",
    "remarks": "",
    "diff": -19.333333333333,
    "status": "notcritical"
  },
  "WY416": {
    "ERC": 31,
    "obsdate": "09\/27\/2016",
    "ERC24": 29,
    "ERC48": 24,
    "ERC72": 23.5,
    "ThreeDayAverage": 28,
    "ERC_threshold": 44,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-16 16:29:07",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "TDC-NOR",
    "CWA": "RIW",
    "justification": "",
    "remarks": "",
    "diff": -16,
    "status": "notcritical"
  },
  "UT484": {
    "ERC": 31,
    "obsdate": "09\/27\/2016",
    "ERC24": 29,
    "ERC48": 25,
    "ERC72": 24,
    "ThreeDayAverage": 28.3,
    "ERC_threshold": 64,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-09 10:06:03",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "UBC-BAR",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": -35.666666666667,
    "status": "notcritical"
  },
  "UT486": {
    "ERC": 25,
    "obsdate": "09\/27\/2016",
    "ERC24": 22,
    "ERC48": 19,
    "ERC72": 9,
    "ThreeDayAverage": 22,
    "ERC_threshold": 73,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-09 10:06:03",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "UBC-BAR",
    "CWA": "GJT",
    "justification": "",
    "remarks": "",
    "diff": -51,
    "status": "notcritical"
  },
  "UT487": {
    "ERC": 47,
    "obsdate": "09\/27\/2016",
    "ERC24": 44,
    "ERC48": 43,
    "ERC72": 39,
    "ThreeDayAverage": 44.7,
    "ERC_threshold": 77,
    "manual": "----Select Manual Override------",
    "updated": "2016-09-09 10:06:03",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "UBC-BAR",
    "CWA": "GJT",
    "justification": "",
    "remarks": "",
    "diff": -32.333333333333,
    "status": "notcritical"
  },
  "UT481": {
    "ERC": 32,
    "obsdate": "09\/27\/2016",
    "ERC24": 30,
    "ERC48": 28,
    "ERC72": 24,
    "ThreeDayAverage": 30,
    "ERC_threshold": 84,
    "manual": "notcritical",
    "updated": "2016-09-14 11:10:33",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "9000",
    "center_id": "UBC-ERS",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": -54,
    "status": "notcritical"
  },
  "UT483": {
    "ERC": 37,
    "obsdate": "09\/27\/2016",
    "ERC24": 36,
    "ERC48": 33,
    "ERC72": 22,
    "ThreeDayAverage": 35.3,
    "ERC_threshold": 86,
    "manual": "notcritical",
    "updated": "2016-09-14 11:10:33",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "9000",
    "center_id": "UBC-ERS",
    "CWA": "SLC",
    "justification": "",
    "remarks": "",
    "diff": -50.666666666667,
    "status": "notcritical"
  },
  "UT485": {
    "ERC": 32,
    "obsdate": "09\/27\/2016",
    "ERC24": 30,
    "ERC48": 28,
    "ERC72": 20,
    "ThreeDayAverage": 30,
    "ERC_threshold": 82,
    "manual": "notcritical",
    "updated": "2016-09-14 11:10:33",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "9000",
    "center_id": "UBC-ERS",
    "CWA": "GJT",
    "justification": "",
    "remarks": "",
    "diff": -52,
    "status": "notcritical"
  },
  "ID403": {
    "ERC": 64,
    "obsdate": "09\/27\/2016",
    "ERC24": 61,
    "ERC48": 58,
    "ERC72": 54,
    "ThreeDayAverage": 61,
    "ERC_threshold": 71,
    "manual": "----Select Manual Override------",
    "updated": "2016-07-21 21:12:27",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7000",
    "center_id": "BDC-SCO",
    "CWA": "BOI",
    "justification": "",
    "remarks": "",
    "diff": -10,
    "status": "borderline"
  },
  "ID421": {
    "ERC": 48.8,
    "obsdate": "09\/27\/2016",
    "ERC24": 46.4,
    "ERC48": 44.2,
    "ERC72": 44.6,
    "ThreeDayAverage": 46.5,
    "ERC_threshold": 76,
    "manual": "critical",
    "updated": "2016-07-21 21:12:27",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7500",
    "center_id": "BDC-SCO",
    "CWA": "BOI",
    "justification": "",
    "remarks": "",
    "diff": -29.533333333333,
    "status": "notcritical"
  },
  "NV454": {
    "ERC": 75.333333333333,
    "obsdate": "09\/27\/2016",
    "ERC24": 74,
    "ERC48": 73.7,
    "ERC72": 74,
    "ThreeDayAverage": 74.3,
    "ERC_threshold": 88,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-14 12:55:08",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "6745",
    "center_id": "BMD",
    "CWA": "LKN",
    "justification": "",
    "remarks": "",
    "diff": -13.666666666667,
    "status": "notcritical"
  },
  "NV457": {
    "ERC": 81.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 80.8,
    "ERC48": 80.8,
    "ERC72": 82.8,
    "ThreeDayAverage": 81,
    "ERC_threshold": 88,
    "manual": "----Select Manual Override------",
    "updated": "2016-08-14 12:55:08",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "6590",
    "center_id": "BMD",
    "CWA": "LKN",
    "justification": "",
    "remarks": "",
    "diff": -7,
    "status": "borderline"
  },
  "NV469": {
    "ERC": 54.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 52.5,
    "ERC48": 51,
    "ERC72": 56,
    "ThreeDayAverage": 52.7,
    "ERC_threshold": 75,
    "manual": "notcritical",
    "updated": "2016-09-23 11:47:34",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7500",
    "center_id": "EKD",
    "CWA": "LKN",
    "justification": "Widespread Precipitation ",
    "remarks": "Live fuel moisture readings 60% Palisades and 71% Adobe Creek. Fire behavior and safety concerns are decreasing, but potential for large fire growth during shortened burning periods still exist if drying occurs. Most recent widespread precipitation has dropped fuels out of critical status.",
    "diff": -22.333333333333,
    "status": "notcritical"
  },
  "NV470": {
    "ERC": 47.666666666667,
    "obsdate": "09\/27\/2016",
    "ERC24": 47,
    "ERC48": 47,
    "ERC72": 58.7,
    "ThreeDayAverage": 47.2,
    "ERC_threshold": 75,
    "manual": "notcritical",
    "updated": "2016-09-23 11:47:34",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "7500",
    "center_id": "EKD",
    "CWA": "LKN",
    "justification": "Widespread Precipitation",
    "remarks": "Live fuel moisture readings 77% at Wells. Fire behavior and safety concerns are decreasing, but potential for large fire growth during shortened burning periods still exist if drying occurs. Most recent widespread precipitation has dropped fuels out of critical status.",
    "diff": -27.777777777778,
    "status": "notcritical"
  },
  "NV455": {
    "ERC": 63.333333333333,
    "obsdate": "09\/27\/2016",
    "ERC24": 61.3,
    "ERC48": 60.7,
    "ERC72": 64.7,
    "ThreeDayAverage": 61.8,
    "ERC_threshold": 84,
    "manual": "critical",
    "updated": "2016-07-08 12:54:34",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "ELD",
    "CWA": "LKN",
    "justification": "",
    "remarks": "Same fuels status as last entry. With the expected winds and low RH much of the zone should be considered critical",
    "diff": -22.222222222222,
    "status": "notcritical"
  },
  "NV461": {
    "ERC": 85.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 84,
    "ERC48": 84.5,
    "ERC72": 86,
    "ThreeDayAverage": 84.7,
    "ERC_threshold": 92,
    "manual": "critical",
    "updated": "2016-07-08 12:40:57",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "ELD",
    "CWA": "VEF",
    "justification": "",
    "remarks": "The current trend for fuels and ERC warrant a critical status in Zone 461 ",
    "diff": -7.3333333333333,
    "status": "borderline"
  },
  "NV458": {
    "ERC": 81.25,
    "obsdate": "09\/27\/2016",
    "ERC24": 80,
    "ERC48": 78.5,
    "ERC72": 76.3,
    "ThreeDayAverage": 79.9,
    "ERC_threshold": 80,
    "manual": "----Select Manual Override------",
    "updated": "2016-06-27 13:03:41",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "WID",
    "CWA": "RNO",
    "justification": "",
    "remarks": "",
    "diff": -0.083333333333329,
    "status": "borderline"
  },
  "NV467": {
    "ERC": 84,
    "obsdate": "09\/27\/2016",
    "ERC24": 82,
    "ERC48": 81.7,
    "ERC72": 76.3,
    "ThreeDayAverage": 82.6,
    "ERC_threshold": 80,
    "manual": "critical",
    "updated": "2016-06-27 13:03:41",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "WID",
    "CWA": "LKN",
    "justification": "",
    "remarks": "",
    "diff": 2.5555555555556,
    "status": "critical"
  },
  "NV468": {
    "ERC": 65.666666666667,
    "obsdate": "09\/27\/2016",
    "ERC24": 63.7,
    "ERC48": 63.3,
    "ERC72": 61.7,
    "ThreeDayAverage": 64.2,
    "ERC_threshold": 80,
    "manual": "critical",
    "updated": "2016-06-27 13:03:41",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "WID",
    "CWA": "LKN",
    "justification": "",
    "remarks": "",
    "diff": -15.777777777778,
    "status": "notcritical"
  },
  "CA272": {
    "ERC": 83,
    "obsdate": "09\/27\/2016",
    "ERC24": 83,
    "ERC48": 82,
    "ERC72": 79,
    "ThreeDayAverage": 82.7,
    "ERC_threshold": 0,
    "manual": "critical",
    "updated": "2016-06-27 13:03:41",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "unknown",
    "CWA": "RNO",
    "justification": "",
    "remarks": "",
    "diff": 82.666666666667,
    "status": "critical"
  },
  "CA273": {
    "ERC": 83.5,
    "obsdate": "09\/27\/2016",
    "ERC24": 83,
    "ERC48": 81.5,
    "ERC72": 80,
    "ThreeDayAverage": 82.7,
    "ERC_threshold": 0,
    "manual": "critical",
    "updated": "2016-06-27 13:03:41",
    "expired": "Yes",
    "cured": "Yes",
    "elevation": "",
    "center_id": "unknown",
    "CWA": "RNO",
    "justification": "",
    "remarks": "",
    "diff": 82.666666666667,
    "status": "critical"
  }
  }





const reduce = Function.bind.call(Function.call, Array.prototype.reduce);
const isEnumerable = Function.bind.call(Function.call, Object.prototype.propertyIsEnumerable);
const concat = Function.bind.call(Function.call, Array.prototype.concat);
const keys = Reflect.ownKeys;

if (!Object.values) {
    Object.values = function values(O) {
        return reduce(keys(O), (v, k) => concat(v, typeof k === 'string' && isEnumerable(O, k) ? [O[k]] : []), []);
    };
}

if (!Object.entries) {
    Object.entries = function entries(O) {
        return reduce(keys(O), (e, k) => concat(e, typeof k === 'string' && isEnumerable(O, k) ? [[k, O[k]]] : []), []);
    };
}

var map = new Map(Object.entries(isCritical));

var zones = [];
var statusArray = [];

function logMapElements(value, key, map){
    //console.log("zone: " + key + " status: " + value.status); 
    
    zones.push(key);
    statusArray.push(value.status);
    // var zoneStatus = {
    //     key: +"'"value.status + "'";
    //     console.log("zoneStatus: " + zoneStatus);
    // }

}
array1 = [];
array2 = []
new Map(map).forEach(logMapElements)
var finalarray = [];
zones.reduce(function(prev,curr,index) {
    var oo = {};
    var key = curr;
    oo[key] = statusArray[index];
    finalarray[index] = oo;
    // console.log(oo)
    // prev.push(oo);
    return prev;
}, finalarray);

// console.log(finalarray)
var zonePosition = {ID404: "0", ID405: "1", ID406: "2", ID407: "3", ID408: "4", ID409: "5", ID412: "6", ID418:"7", ID419: "8", NV453: "9", UT420:"10", UT421:"11", AZ102:"12", AZ101:"13", AZ104:"14", AZ105:"15", ID401:"16",ID402:"17", ID403:"18",ID410:"19",ID411:"20",ID413:"21",ID420:"22",ID421:"23",ID422:"24",ID423:"25",ID475:"26", ID476:"27", ID477:"28", UT422:"29", UT423:"30", ID400:"31", ID424:"32", ID425:"33", ID426:"34", ID427:"35", NV450:"36", NV455:"37", NV457:"38", NV458:"39", NV459:"40", NV460:"41", NV461:"42", NV462:"43", NV463:"44", NV464:"45", NV465:"46", NV466:"47", NV467:"48", NV468:"49", NV469:"50", NV470:"51", UT424:"52", UT478:"78", UT479:"79", UT480:"80", UT481:"81", UT482:"82", UT483:"83", UT484:"84", UT485:"85", UT486:"86", UT487:"87", UT488:"88", UT489:"89", UT490:"90", UT491:"91", UT492:"92", UT493:"93", UT494:"94", UT495:"95", UT496:"96", UT497:"97", UT498:"98", WY414:"99", WY415:"100", WY416:"101", NV454:"102"};
//console.log(map);
// var oneArray = Object.keys(isCritical);
// var twoArray = []
// newArray.map(function(c,i) {

// });
// var notSure = [];


// var fillZoneStatus = isCritical.reduce(function(prev, curr, j) {  
//     var oo = {};
//     var zone = curr['zone'];
//     var status = curr['status'];
//     oo[zone] = status;
//     prev.push(oo);
//     // prev.push([ curr['zone'], curr['status']]);
//     // console.log(prev);
// //   // prev[0].push(curr["zone"]);
// //   prev[1].push(curr["status"]);
// //   console.log(prev);
// //   console.log(prev[0]);
// // console.log(prev[1]);
// //   // c
//   return prev;
// }, notSure);

// console.log(JSON.stringify(notSure));
// function resSort (array) {
//   return array.map(function(current_value, index, initial_array) {
//     var oo = {};
//     // console.log(current_value);
//     var key = current_value['zone'];
//     // console.log(key);
//     // var str = current_value.attributes.IncNumber;
//     // var key = str.length = 15 ? str.slice(0, 4) + '-' + str.slice(4, 9) + '-' + str.slice(9, 15) : str.slice(0, 4) + '-' + str.slice(4, 10) + '-' + str.slice(9, 16) ; 
//     var Name = current_value['status'];
//     // console.log(Name);
//     oo[key] = Name;
//     return oo;
//   }); 
// }
// resSort(isCritical);

// var raws = [
//   {
//     "name":"Cart Creek",
//     "lat":40.884722,
//     "lon":-109.416944,
//     "id":420805,
//     "highest":104,
//     "p97":87,
//     "p90":81,
//     "p80":74,
//     "p70":68,
//     "p50":58
//   },
//   {
//     "name":"Catfish",
//     "lat":44.326111,
//     "lon":-117.169444,
//     "id":101402,
//     "highest":105,
//     "p97":98,
//     "p90":93,
//     "p80":89,
//     "p70":84,
//     "p50":73
//   },
//   {
//     "name":"3 Mile",
//     "lat":44.396,
//     "lon":-112.108,
//     "id":102004,
//     "highest":90,
//     "p97":84,
//     "p90":78,
//     "p80":69,
//     "p70":60,
//     "p50":52
//   },
//   {
//     "name":"Alligator Ridge",
//     "lat":39.737,
//     "lon":-115.518,
//     "id":260804,
//     "highest":111,
//     "p97":103,
//     "p90":98,
//     "p80":94,
//     "p70":90,
//     "p50":82
//   }
// ]
// var isCritical=
// [
//  {
//             "zone": "UT497",
//             "ERC": 78,
//             "ERC24": 73,
//             "ERC48": 69,
//             "ERC72": 83.5,
//             "ThreeDayAverage": 73.333333333333,
//             "ERC_threshold": 70,
//             "manual": "----Select Manual Override------",
//             "updated": "2016-06-20 11:56:54",
//             "expired": "Yes",
//             "cured": "Yes",
//             "elevation": "",
//             "center_id": "CDC-SIDLES",
//             "CWA": "SLC",
//             "justification": "",
//             "remarks": "",
//             "diff": 3.3333333333333,
//             "status": "critical"
//         },
//         {
//             "zone": "ID475",
//             "ERC": 79.6,
//             "ERC24": 79,
//             "ERC48": 79,
//             "ERC72": 78.8,
//             "ThreeDayAverage": 79.2,
//             "ERC_threshold": 55,
//             "manual": "----Select Manual Override------",
//             "updated": "2016-07-18 15:10:58",
//             "expired": "Yes",
//             "cured": "Yes",
//             "elevation": "",
//             "center_id": "CIC-KNA",
//             "CWA": "PIH",
//             "justification": "",
//             "remarks": "",
//             "diff": 24.2,
//             "status": "critical"    
//         }
//  ]
    
// var zone = [];
// var status = [];

// var vectorStyleCache = {};
// var vectorStyleFunction = function(feature) {
//   var zone = feature.get('STATE_ZONE');
//   var status = isCritical[zone]['status'];
//   var color;
//   var style = new ol.style.Style({
//     // fill: new ol.style.Fill({
//     //   color: color
//     // })
//     // ,
//     // stroke: new ol.style.Stroke({
//     //   color: color,
//     //   width: 4
//     // }),
//     // text: new ol.style.Text({
//     //   font: '.9rem Montserrat, sans-serif',
//     //   fill: new ol.style.Fill({
//     //     color: '#000'
//     //   })
//     //   // ,
//     //   // stroke: new ol.style.Stroke({
//     //   //   color: '#fff',
//     //   //   width: 3
//     //   // })
//     // })
//   });
//   if (status = 'critical') {
//     color = 'red';
//     style.getFill() = new ol.style.Fill({
//       color: color
//   })
//   if (stat)
//   return style;
// }

          var xyz = new ol.layer.Tile({
            source: new ol.source.XYZ({
              url: 'http://maps.nypl.org/warper/maps/tile/11042/{z}/{x}/{y}.png'
            }),
            opacity: .5
          })

var fillcolor = '#FFCCFF';
var vectorLayer = new ol.layer.Vector({
  source: new ol.source.Vector({
    // url: 'layers/esrijson/gbPSA.json',
    // format: new ol.format.EsriJSON()
    //url: 'fireWxZoneJsonAll.json', this one works
    url: 'NWSFireWxZones.geojson', 
    // format: new ol.format.TopoJSON()
    format: new ol.format.GeoJSON()
  }),
  wrapX: false,
  minResolution: 0,
  maxResolution: 10000,
  visible: true,
  // style: vectorStyleFunction 

  style: function(feature, resolution) {
    var style = new ol.style.Style({
      fill: new ol.style.Fill({
        color: 'rgba(255, 255, 255, 0.1)'
      }),
      stroke: new ol.style.Stroke({
        color: 'rgb(183, 183, 183)', //'rgba(0, 0, 0, 0.4)',
        width: 2
      }),
      text: new ol.style.Text({
        font: '15px Montserrat, sans-serif',
        fill: new ol.style.Fill({
          color: '#000'
        }),
        stroke: new ol.style.Stroke({
          color: 'rgba(238, 238, 238, .7)',
          width: 3
        })
      })
    });

    // var fillcolor = '#FFCCFF';
    var zone = feature.get('STATE_ZONE');
    

    // console.log("zone: " + zone)
    // var status = isCritical["'"zone"'"]['status'];
    var status = isCritical[zone] ? isCritical[zone]['status'] : 'nodata';
    if (status=='critical'){
      style.getFill().setColor('rgba(160, 35, 28, 0.8)');
      var fillcolor = '#ccfeff';
     // return fillcolor;
    }
    if (status=='notcritical'){
      style.getFill().setColor('rgba(44, 107, 36, 0.8)');
      var fillcolor = '#6415cc';
      // return fillcolor;
    }
    if (status=='borderline'){
      style.getFill().setColor('rgba(249, 238, 31, 0.8)');
      var fillcolor = '#15cc7e';
      // return fillcolor;
    }
    if (status=='nodata'){
      style.getFill().setColor('rgba(176, 176, 176, 1)');
      var fillcolor = '#15cc7e';
      // return fillcolor;
    }
    // style.getFill() = new ol.style.Fill({
    //     color: color
    // })  
   
    style.getText().setText(resolution < 5000 ? feature.get('STATE_ZONE'): '');
    return style;
  }
});
    var selectZone = new ol.style.Style({
    // if (status=='borderline'){
      // var fillcolor = '#15cc7e';
      // console.log('borderline fillcolor: ' + fillcolor + 'styleZone '+ zone)
      // return fillcolor;
    // }
       fill: new ol.style.Fill({
        // color: fillcolor
        color: 'rgba(162, 0, 23, 0.1)'
        // if (status=='critical'){
        //     color: '#FFCCFF'
        // }
        // if (status=='notcritical'){
        //     color: '#FFCCFF'
        // }
        // if (status=='borderline'){
        //     color: '#FFCCFF'
        // }
        
       }),
      stroke: new ol.style.Stroke({
        color: '#FFCCFF',
        width: 2
     })
  });

var raster = new ol.layer.Tile({
  source: new ol.source.XYZ({
    attributions: 'Tiles © <a href="http://services.arcgisonline.com/ArcGIS/' +
        'rest/services/World_Topo_Map/MapServer">ArcGIS</a>',
    url: 'http://server.arcgisonline.com/ArcGIS/rest/services/' +
        'World_Topo_Map/MapServer/tile/{z}/{y}/{x}'
  }),
  wrapX: false,
  minResolution: 1501,
  maxResolution: 50000
});

var stamenLayer = new ol.layer.Tile({
        source: new ol.source.Stamen({
          layer: 'toner-lite'
          // layer: 'terrain-lines'
        })
      });

var esriOceanBasemap = new ol.layer.Tile({
        source: new ol.source.Stamen({
          layer: 'toner-lite'
          // layer: 'terrain-lines'
        })
      });

/**
 * Elements that make up the popup.
 */
var container = document.getElementById('popup');
var content = document.getElementById('popup-content');
var closer = document.getElementById('popup-closer');


/**
 * Create an overlay to anchor the popup to the map.
 */
var overlay = new ol.Overlay(/** @type {olx.OverlayOptions} */ ({
  element: container,
  autoPan: true,
  autoPanAnimation: {
    duration: 250
  }
}));




/**
 * Add a click handler to hide the popup.
 * @return {boolean} Don't follow the href.
 */
closer.onclick = function() {
  overlay.setPosition(undefined);
  closer.blur();
  return false;
};



var map = new ol.Map({
  layers: [
    stamenLayer,
    //xyz,
    // new ol.layer.Tile({
    //   source: new ol.source.OSM(),
    //   wrapX: false,
    //   // minResolution: 0,
    //   // maxResolution: 1500
    // }),
    // new ol.layer.Tile({
    //   source: new ol.source.TileJSON({
    //     url: 'http://api.tiles.mapbox.com/v3/' +
    //          'mapbox.natural-earth-hypso-bathy.json',
    //     crossOrigin: 'anonymous'
    //   }),
    //   wrapX: false,
    //   minResolution: 1501,
    //   maxResolution: 50000
    // }),
    // raster,
    vectorLayer,
    // vectorLayer2  
  ],
  overlays: [overlay],
  target: 'map',
  view: new ol.View({
    center: [-12753260.184760537, 4948659.629345282],
    // center: ol.proj.transform([-114.012036, 40.440194], 'EPSG:4326', 'EPSG:3857'),
    zoom: 5.6,
    // minZoom: 5,
    // maxZoom: 9.8,
    extent:[ -13385849.855545742, 4164163.9360093023, -12120670.513975333, 5733155.322681262 ]
  }),
});

var selectClick = new ol.interaction.Select({
  condition: ol.events.condition.click,
  layers: [
    vectorLayer
  ],
  style: function(feature) {
    var zone = feature.get('STATE_ZONE');
    // var status = isCritical[zone]['status'];
    var status = isCritical[zone] ? isCritical[zone]['status'] : 'nodata';
    var color;
      if (status=='critical') {
        color = 'rgba(160, 35, 28, 1)'
      }
      if (status=='notcritical') {
        color = 'rgba(44, 107, 36, 1)'
      }
      if (status=='borderline') {
        color = 'rgba(249, 238, 31, 1)'
      }
      if (status=='nodata'){
        color = 'rgba(176, 176, 176, 1)';
      // return fillcolor;
    }
    // console.log(color);
    var style = new ol.style.Style({
      fill: new ol.style.Fill({
        color:  color
      }),
      stroke: new ol.style.Stroke({
        color: 'black',
        width: 2
      }),
      text: new ol.style.Text({
        font: '15px Montserrat, sans-serif',
        fill: new ol.style.Fill({
          color: '#000'
        }),
         stroke: new ol.style.Stroke({
          color: 'rgba(238, 238, 238, .7)',
          width: 3
        }),
        text: zone
      })
    });

    return style;

  }
});
/**
 * Add a click handler to the map to render the popup.
 */
 var zoneSelect;
map.addInteraction(selectClick);
selectClick.on('select', function(e) {

  var feature = e.selected[0];
  var coord = e.mapBrowserEvent.coordinate;
  zoneSelect = feature.get('STATE_ZONE');

  // console.log(zoneSelect)
  // var zoneERC = isCritical[zoneSelect]['ERC'];
  var zoneERC = isCritical[zoneSelect] ? isCritical[zoneSelect]['status'] : 'No Data';
  var ERC = isCritical[zoneSelect] ? isCritical[zoneSelect]['ERC'] : 'No Data';
  var ERC24 = isCritical[zoneSelect] ? isCritical[zoneSelect]['ERC24'] : 'No Data';
  var ERC48 = isCritical[zoneSelect] ? isCritical[zoneSelect]['ERC48'] : 'No Data';
  var ERC72 = isCritical[zoneSelect] ? isCritical[zoneSelect]['ERC72'] : 'No Data';
  var ThresholdText;

  // var status = isCritical[zoneSelect]['status'];
  var status = isCritical[zoneSelect] ? isCritical[zoneSelect]['status'] : 'No Data';
  // var obsUpdate = isCritical[zoneSelect]['date'];
  var obsUpdate = isCritical[zoneSelect] ? isCritical[zoneSelect]['obsdate'] : 'No Data';
  // var threeDayAverage = Math.round(isCritical[zoneSelect]['ThreeDayAverage']);
  // var threeDayAverage = isCritical[zoneSelect]['ThreeDayAverage'];
  var threeDayAverage = isCritical[zoneSelect] ? isCritical[zoneSelect]['ThreeDayAverage'] : 'No Data';
  // threeDayAverage=threeDayAverage.toFixed(1);
  // var Threshold = isCritical[zoneSelect]['ERC_threshold'];
   var Threshold = isCritical[zoneSelect] ? isCritical[zoneSelect]['ERC_threshold'] : 'No Data';
   // var Threshold1 = WY416[0]["ERC_threshold "] ? WY416[0]["ERC_threshold "] : 'No Data';
   // var updated = sinceApril[0]["updated"] ? sinceApril[0]["updated"] : 'No Data';
   var zoneHeader = document.getElementById("zoneHeader");
  // console.log('zoneSelect elevation: ' + zoneSelect);
  // console.log(zoneERC);
  var zoneSelectPosition = zonePosition[zoneSelect];
  var getZoneObject = fetched5[zoneSelectPosition];
  console.log('zoneSelect position: ' + zoneSelectPosition);
  // console.log('Get zone object: '+getZoneObject);
  var orderedByDate=[];
  getZoneObject[zoneSelect].map(function(curr, index) {
    var x = curr;
    var dateObj = Date.parse(x.updated);
    x.updated = dateObj;
    orderedByDate.push(x);
    });
  // console.log('ordered by date' + orderedByDate);
  var sortDate = getZoneObject[zoneSelect].sort(dynamicSort("updated"));
  // console.log('sort date: ' + sortDate[0]["updated"]);
  // console.log('sort date length: ' + sortDate.length);
  var accessObject = fetched5[zoneSelectPosition][zoneSelect];
  // console.log('position of zone: ' + zoneSelectPosition);
  // console.log('accessobject: ' + accessObject);
  var apr12016 = 1459468800000; //To get this number Date.parse("2016-04-01")
  var sinceApril = [];

    sortDate.filter(function(curr, index) {
        if(curr["updated"] >= apr12016) {
            sinceApril.push(curr);
        }
    })

    // console.log('since april: ' + sinceApril[0]['zone']);
    stuff.innerHTML = JSON.stringify(sinceApril);
  // console.log('accessobject: ' + fetched5[36][zoneSelect]);
  // console.log(Threshold1);
    // content.innerHTML = zoneSelect + ': ' + status;
  content.innerHTML = zoneSelect + ': ' + status + ' <br />3 Day ERC average: ' + threeDayAverage + ' <br />Critical Threshold:' + Threshold + '<br /> Observations updated ' + obsUpdate;
    // content.innerHTML = zoneSelect + ': ' + status + ' <br />3 Day ERC average: ' + threeDayAverage +  '<br /> Observations updated ' + obsUpdate;
    // content.innerHTML = 'Zone: <code>' + zoneSelect + '</code>';
  overlay.setPosition(coord);
  zoneHeader.innerHTML = 'Zone ' + zoneSelect;
  if(status=='notcritical'){
    zoneHeader.style.backgroundColor = 'rgba(86, 137, 80, 0.43)';
  }
  else if(status=='critical'){
    zoneHeader.style.backgroundColor = 'rgba(179, 79, 73, 0.77)';
  }

  else if(status=='borderline'){
    zoneHeader.style.backgroundColor = 'rgba(250, 241, 76, 0.75)';
  }  
  else {
    zoneHeader.style.backgroundColor = '#f5f5f5';
  } 
for (var i = 0; i < sinceApril.length; i++) { 
   ThresholdText += sinceApril[i]["ERC_threshold"] + "<br>";
}
var TableText;

for (var i = 0; i < sinceApril.length; i++) { 
    var newDate = new Date(sinceApril[i]["updated"]);
    var year = newDate.getFullYear();
    var month = newDate.getMonth();
    var day = newDate.getDate();
    var hour = newDate.getHours();
    var minutes = newDate.getMinutes();
    var seconds = newDate.getSeconds();
    var tableManual=sinceApril[i]["manual"];
    if (tableManual=="critical"){
        tableManual = "Critical";
    }
    else if (tableManual =="notcritical"){
        tableManual = "Not Critical";
        }
    else{
        tableManual = "No";
    }
    var ERCThresholdTable = sinceApril[i]["ERC_threshold "] ? sinceApril[i]["ERC_threshold "] : sinceApril[i]["ERC_threshold"];
    var curedTable = sinceApril[i]["cured "] ? sinceApril[i]["cured "] : sinceApril[i]["cured"];
   // TableText += '<tr><th scope="row">'+ newDate +'</th><td>' + sinceApril[i]["elevation"]+ '</td><td>' + curedTable + '</td><td>' + ERCThresholdTable + '</td><td>' + tableManual + '</td><td>' + sinceApril[i]["justification"] + '</td><td>' + sinceApril[i]["remarks"] + '</td></tr>';
   TableText += '<tr><th scope="row">'+ month + '/' + day + '/' + year + ' '+hour+':'+minutes+':'+seconds+' MDT </th><td>' + sinceApril[i]["elevation"]+ '</td><td>' + curedTable + '</td><td>' + ERCThresholdTable + '</td><td>' + tableManual + '</td><td>' + sinceApril[i]["justification"] + '</td><td style="word-wrap: break-word;min-width: 160px;max-width: 160px;">' + sinceApril[i]["remarks"] + '</td></tr>';
}

  // zoneHeader.style.backgroundColor = 'rgba(86, 137, 80, 0.43)';
  // document.getElementById("bigText").innerHTML = '<br /> Observations updated ' + obsUpdate;
  document.getElementById("zoneHistory").innerHTML = 'Observations updated ' + obsUpdate + ' <br />Critical Threshold: ' + Threshold + '<br />3 Day ERC average: ' + threeDayAverage + '<br />Current ERC: ' + ERC + ' ERC 24 hours ago: ' + ERC24+ ' ERC 48 hours ago: ' + ERC48 + '<br /> \
  <div class = "table-responsive"><table class="table table-responsive table-hover table-sm">  <thead><tr><th>Date</th><th>Elevation</th><th>Cured</th><th>ERC Threshold</th><th>Set Manually? \
  </th><th>Justification</th><th>Remarks</th></tr>  </thead><tbody>' + TableText + '</table></div>';
  // document.getElementById("zoneHistory").innerHTML = '<br /> Observations updated ' + obsUpdate + ' <br />Critical Threshold:' + Threshold + '3 Day ERC average: ' + threeDayAverage + 'Current ERC';
})


// var highlightStyleCache = {};

// var featureOverlay = new ol.layer.Vector({
//   source: new ol.source.Vector(),
//   map: map,
//   style: function(feature, resolution) {
//     var text = resolution < 5000 ? feature.get('') : '';
//     if (!highlightStyleCache[text]) {
//       highlightStyleCache[text] = new ol.style.Style({
//         stroke: new ol.style.Stroke({
//           color: '#f00',
//           width: 1
//         }),
//         fill: new ol.style.Fill({
//           color: 'rgba(255,0,0,0.1)'
//         }),
//         text: new ol.style.Text({
//           font: '12px Montserrat, sans-serif',
//           text: text,
//           fill: new ol.style.Fill({
//             color: '#000'
//           }),
//           stroke: new ol.style.Stroke({
//             color: '#f00',
//             width: 3
//           })
//         })
//       });
//     }
//     return highlightStyleCache[text];
//   }
// });

// var highlight;

// var displayFeatureInfo = function(pixel) {
  
//   var feature = map.forEachFeatureAtPixel(pixel, function(feature) {
//     return feature; 
//   });
//   var info = document.getElementById('info');
//     if (feature) {
//       info.innerHTML =  feature.get('PSA_NAME') + ': ' + feature.get('NAT_CODE');
//     } 
//     else {
//       info.innerHTML = '';
//     }
//     if (feature !== highlight) {
//       if (highlight) {
//         featureOverlay.getSource().removeFeature(highlight);
//       }
//       if (feature) {
//         featureOverlay.getSource().addFeature(feature);
//       }
//       highlight = feature;
//     }
// }



// map.on('click', function(evt) {
//   var pixel = map.getEventPixel(evt.originalEvent);
//   displayFeatureInfo(pixel);
//   flyToDispatch(pixel);
// });

// map.updateSize();


// function getvar() {
//   //do stuff
// }

// var getvar = function() {
//   // do stuff
// }
// function +(x,y) {
//   // add x and y
// }
// +(2,3)
// var statement;
// Number(false) = 0;
// Number(null) 
// (!statement) ? do x : do y





map.getView().fit([ -13385849.855545742, 4164163.9360093023, -12120670.513975333, 5733155.322681262 ], (map.getSize()), {padding: [20, 80, 80, 80], constrainResolution: false})
// var perimeterExtent = [ -13385849.855545742, 4164163.9360093023, -12120670.513975333, 5733155.322681262 ];
// var size = map.getSize();
// map.getView().fit(perimeterExtent, size, {padding: [80, 80, 80, 80], constrainResolution: false})
// map.getView().setZoom(5);
// map.getView().setZoom(map.getView().getZoom()+1);

function dynamicSort(property) {
    var sortOrder = -1;
    if(property[0] === "-") {
        sortOrder = -1;
        property = property.substr(1);
    }
    return function (a,b) {
        var result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;
        return result * sortOrder;
    }
}

map.updateSize();

var mlabKey = 'XJGyTcrWEYUrzsEcUnxqany6FK7XsECM';

function ajax(options) {
  return new Promise(function(resolve, reject) {
    var xhr = new XMLHttpRequest();
    xhr.open(options.method, options.url);
    xhr.responseType = '';
    xhr.onload = function() {
      if (this.status <= 200 && this.status < 300) {
        resolve(xhr.response);
      } 
      else {
        reject({
          status: this.status,
          statusText: xhr.statusText
        });
      }
    };
    xhr.onerror = function() {
      reject({
        status: this.status,
        statusText: xhr.statusText
      });
    };
    if (options.headers) {
      Object.keys(options.headers).forEach(function(key) {
        xhr.setRequestHeader(key, options.headers[key]);
      });
    };
    var params = options.params;
    // We'll need to stringify if we've been given an object
    // If we have a string, this is skipped.
    if (params && typeof params === 'object') {
      params = Object.keys(params).map(function (key) {
        return encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);
      }).join('&');
    };
    xhr.send(params);
  });
}

// ajax({
//     method: 'POST',
//     url: 'https://api.mlab.com/api/1/databases/fuelzonemaps/collections/createdfeatures?&apiKey=' + mlabKey,
//     params: data,
//     headers: {
//         'Content-Type': 'application/json'
//     }
//   })
//   .then(function(response) {
//     console.log(response);
//   })
//   .catch(function(error) {
//     console.error('damnit.', error.statusText);
//   });      
// }
var fetched1;
var fetched2;
var fetched3;
var fetched4;
var fetched5;
var WY416;
var mlab = {
  method: 'GET',
  url: 'https://api.mlab.com/api/1/databases/fuel_status/collections/zoneinfo?apiKey=' + mlabKey,
  headers: {
    'Content-Type': 'application/json'
  }
}

ajax(mlab)
.then(function(first) {
  fetched1 = JSON.parse(first);
  // console.log(fetched1[0]);
   // = perims[0];
  return ajax({
    method: 'GET',
    url: 'https://api.mlab.com/api/1/databases/fuel_status/collections/password?l=1&apiKey=' + mlabKey,
    headers: {
      'Content-Type': 'application/json'
    }
  });
})
.then(function(second) {
  fetched2 = JSON.parse(second);
  // console.log('fetched2' + fetched2);
  return ajax({
    method: 'GET',
    url: 'NWSFireWxZones.geojson'
  });
})
.then(function(third) {
  fetched3 = JSON.parse(third);
  // console.log('fetched3' + fetched3);
  return ajax({
    method: 'GET',
    // url: 'https://api.mlab.com/api/1/databases/fuel_status/collections/status?apiKey=' + mlabKey,
    // url: 'https://api.mlab.com/api/1/databases/fuel_status/collections/status?s={"zone":-1}&apiKey=' + mlabKey,
    url: 'https://api.mlab.com/api/1/databases/fuel_status/collections/status?q={"zone":"WY416"}&s={"updated":-1}&l=10&apiKey=' + mlabKey,
  });
})
.then(function(fourth) {
  WY416 = JSON.parse(fourth);
  //return fetched4;
  // console.log('fetched 4: /n')
  // console.log(fetched4[0]['zone']);
  // console.log(WY416);
  return ajax({
    method: 'GET',
    // url: 'https://api.mlab.com/api/1/databases/fuel_status/collections/status?apiKey=' + mlabKey,
    // url: 'https://api.mlab.com/api/1/databases/fuel_status/collections/status?s={"zone":-1}&apiKey=' + mlabKey,
    url: 'https://api.mlab.com/api/1/databases/fuel_status/collections/schema?s={"updated":-1}&apiKey=' + mlabKey,
  });
})
.then(function(fifth) {
  fetched5 = JSON.parse(fifth);
  // console.log(fetched5);
  

  //return fetched4;
  // console.log('fetched 4: /n')
  // console.log(fetched5[0]['zone']);
  // console.log(fetched5);
  // console.log(WY416);
})
.catch(function(error) {
  console.error('error.', error.statusText);
});      
